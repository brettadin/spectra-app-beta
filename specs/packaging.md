# Packaging and Distribution

Delivering the Spectra‑App as a polished Windows application requires careful consideration of dependencies, installation format and updates.  This document outlines the packaging strategy.

## 1. Packaging Tools

For the recommended PySide6/Qt stack, two primary options exist for packaging the Python application on Windows:

1. **PyInstaller** – A widely used tool that analyzes Python imports and bundles the application and its dependencies into a standalone executable.  Key points:
   * Supports one‑file and one‑folder modes.  For GUI applications, one‑folder mode is preferred to avoid long startup times.
   * Can include non‑Python files (e.g. Qt plugins, icons) via a `spec` file or `--add-data` arguments.
   * Generates a `.exe` and a directory containing DLLs and resources.  Additional steps are required to sign the binary.
   * Supports hooking into Qt to include necessary plugins; using the `–noconsole` flag hides the console window.

2. **MSIX / WiX Toolset** – Microsoft’s packaging formats for Windows:
   * **MSIX** packages combine application files, manifests and digital signatures into a single distributable container.  They support clean uninstallation and updates.  MSIX is recommended by Microsoft for new Windows apps.
   * **WiX Toolset** can build MSI installers.  It offers more control over installation options but is more complex to configure.

For cross‑platform distribution (e.g. macOS or Linux) in future releases, consider using **cx_Freeze** or **Briefcase**.  These can complement the Windows‑first PyInstaller approach.

## 2. Packaging Steps

1. **Prepare the environment:** Ensure all Python dependencies are pinned in `requirements.txt`.  Use a virtual environment to install them and freeze the environment using `pip freeze > requirements.txt`.
2. **Create a PyInstaller spec file:** A `.spec` file describes the entry point (`main.py` in the `app` package), includes data files (e.g. sample datasets, icons, translations), specifies hidden imports (e.g. `PySide6.QtCore`, `PySide6.QtGui`, `matplotlib` if used) and collects Qt plugins (e.g. `platforms`, `styles`).
3. **Build the application:** Run `pyinstaller --clean --noconfirm spectra_app.spec`.  The output appears in the `dist/` folder.  Verify that launching `dist/SpectraApp/SpectraApp.exe` opens the application and displays the correct version.
4. **Sign the binary (optional but recommended):** Obtain a code signing certificate.  Use tools like `signtool.exe` (part of the Windows SDK) to sign the executable and DLLs.  This prevents Windows SmartScreen warnings.
5. **Create an installer:**
   * For **MSIX**, use the `AppxManifest.xml` generated by PyInstaller or create one manually.  Use the MSIX Packaging Tool to wrap the PyInstaller output into an `.msix` package.  Configure the manifest with application identity, capabilities and logos.
   * For **MSI**, use WiX Toolset to author an installer that copies files into `Program Files`, registers shortcuts and includes an uninstaller.
6. **Test installation:** Install the package on Windows 10 and Windows 11 test machines (virtual or physical).  Verify that the installer runs without requiring administrator privileges, the application launches, and uninstallation removes all files.

## 3. Updates and Versioning

The application follows semantic versioning: `MAJOR.MINOR.PATCH` (e.g. `1.0.0`).  The `app/version.json` file stores version information and build date.  Each installer should embed the version in its metadata.  For updates:

* **Manual updates:** Users download and run a new installer.  The MSIX format supports in‑place updates when the package identity is the same.
* **Automatic updates (future work):** Investigate integrating a self‑updater library (e.g. Squirrel.Windows or Tauri’s updater) that checks for new releases and downloads them transparently.  Ensure user consent and integrity verification.

## 4. Portable Build

In addition to an installer, provide a **portable zip** build.  Zip the contents of the `dist/SpectraApp` folder, including all DLLs and resources.  Users can extract the zip to any folder and run `SpectraApp.exe` without installation.  Portable builds are convenient for environments where installation is restricted.

## 5. Dependencies and Licensing

List all third‑party libraries and their licences in an `about_licenses.txt` file included in the installer and in the `Help → About` dialog.  Acknowledge that PySide6 is licensed under the LGPL; if any Qt modules are statically linked (not recommended), comply with the licence by providing a way to relink against modified Qt libraries.

## 6. Continuous Packaging in CI

Set up a CI workflow that triggers on version tags (e.g. `v1.0.0`).  The workflow should:

1. Install the Python environment and dependencies.
2. Build the PyInstaller bundle for Windows.
3. Sign the binary if a certificate is available (stored securely via CI secrets).
4. Package into MSIX and/or MSI using MSIX Packaging Tool or WiX scripts.
5. Upload the installer and portable zip as release artefacts.

## 7. Summary

By using PyInstaller for bundling and MSIX for installation, the project can deliver a seamless Windows experience with minimal setup for users.  Clear versioning, licensing information and optional code signing will help instil trust and facilitate future updates.