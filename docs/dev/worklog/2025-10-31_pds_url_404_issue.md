# PDS Archive URL Issue - MESSENGER MASCS UVVS CDR (2025-10-31)

## Issue Summary

**Date**: 2025-10-31T19:38:48-04:00 (EDT)  
**Component**: PDS Downloader (`tools/pds_downloader_native.py`)  
**Dataset**: MESSENGER MASCS UVVS CDR (Calibrated Data Record)  
**Status**: Unresolved - Requires investigation

## Error Details

### Command Executed
```bash
python tools/pds_downloader_native.py \
  --dataset uvvs_cdr \
  --output-dir "samples\SOLAR SYSTEM\Mercury_test" \
  --max-size 0.5 \
  --dry-run
```

### Error Message
```
❌ Error scanning https://pds-geosciences.wustl.edu/messenger/mess-e_v_h-mascs-3-uvvs-cdr-caldata-v1/messmas_1001/data/cdr/uvvs: 
404 Client Error: Not Found for url: https://pds-geosciences.wustl.edu/messenger/mess-e_v_h-mascs-3-uvvs-cdr-caldata-v1/messmas_1001/data/cdr/uvvs
```

### Expected vs Actual
- **Expected**: Directory listing showing UVVS CDR science files (ufc_*.dat, umc_*.dat, uvc_*.dat)
- **Actual**: HTTP 404 Not Found error
- **Estimated Size**: ~2 GB (shown in dry-run header)
- **Files Downloaded**: 0

## Root Cause Analysis

### Possible Causes

1. **Incorrect Directory Path**
   - The updated URL may have the wrong subdirectory structure
   - PDS archives may not have a `cdr/uvvs` subdirectory under `data/`
   - Original broader path may have been correct

2. **PDS Archive Reorganization**
   - PDS Geosciences node may have restructured the MESSENGER archive
   - Data may have been moved to a different location
   - Archive versioning may have changed

3. **URL Typo or Syntax Error**
   - Extra or missing slashes
   - Incorrect volume/dataset identifier
   - Case sensitivity issue

4. **Archive Accessibility**
   - Temporary server outage (less likely given consistent 404)
   - Access restrictions or permissions
   - Data migration in progress

### Evidence

**Against Typo**:
- URL follows PDS naming conventions correctly
- Other parts of the URL load successfully (parent directories)

**For Wrong Path**:
- The change from `/data/` to `/data/cdr/uvvs/` was an assumption
- No manual verification of the directory structure was performed
- PDS archives don't always follow expected hierarchies

**Neutral**:
- No checksums or file listings were consulted
- Haven't tested the original broader URL

## Investigation Steps

### Immediate (Manual Verification)

1. **Browse PDS Website Manually**
   ```
   Start at: https://pds-geosciences.wustl.edu/messenger/mess-e_v_h-mascs-3-uvvs-cdr-caldata-v1/
   Navigate through: messmas_1001/data/
   Document actual directory structure
   ```

2. **Test Alternative URLs**
   Try these URL variations in browser first:
   - `https://...messmas_1001/data/` (original broad path)
   - `https://...messmas_1001/data/uvvs/` (without 'cdr')
   - `https://...messmas_1001/data/cdr/` (one level up)
   - `https://...messmas_1001/cdr/uvvs/` (cdr at different level)

3. **Check PDS Documentation**
   - Find MESSENGER MASCS data user guide
   - Look for official directory structure diagrams
   - Check for any archive migration notices

### Short-term (Code Testing)

4. **Test with Original URL**
   ```bash
   # Temporarily revert URL to original in code
   "url": "https://...messmas_1001/data/"
   # Run dry-run to see what's actually there
   python tools/pds_downloader_native.py --dataset uvvs_cdr --dry-run
   ```

5. **Add URL Validation**
   ```python
   def validate_base_url(self) -> bool:
       """Test if base URL is accessible before starting crawl."""
       try:
           resp = requests.head(self.base_url, timeout=10)
           return resp.status_code == 200
       except:
           return False
   ```

6. **Implement Path Discovery**
   ```python
   def find_data_directory(self, base_url: str, target_files: list) -> str:
       """Recursively search for directory containing target file patterns."""
       # Breadth-first search for science files
       # Return correct path when found
   ```

### Medium-term (Automation)

7. **Create PDS Archive Crawler**
   - Script to map entire MESSENGER MASCS archive structure
   - Generate directory tree diagram
   - Identify where science files actually live

8. **Add Archive Versioning**
   - Track which version of PDS archive is being used
   - Log when archives were last successfully accessed
   - Alert when archive structure changes

9. **Implement PDS API Integration**
   - Use official PDS APIs for data discovery
   - More reliable than hardcoded URLs
   - Better error messages

## Recommended Next Actions

### Priority 1 (Do First)
- [ ] Manually browse PDS website to find correct path
- [ ] Document actual directory structure in this file
- [ ] Test dry-run with confirmed URL

### Priority 2 (After URL Confirmed)
- [ ] Update `pds_downloader_native.py` with correct URL
- [ ] Test full download (limited size first)
- [ ] Verify downloaded files are correct format
- [ ] Update documentation with correct paths

### Priority 3 (Future Improvements)
- [ ] Add URL validation before starting downloads
- [ ] Implement automatic path discovery
- [ ] Add resume capability for interrupted downloads
- [ ] Create tests that periodically check PDS URLs

## Temporary Workarounds

### Option 1: Use Broader Path (Less Precise)
```python
"url": "https://...messmas_1001/data/"
```
**Pros**: More likely to work, finds files wherever they are  
**Cons**: Downloads more directories, slower, may include unwanted files  
**Recommendation**: Use for initial testing only

### Option 2: Manual Download
- Browse PDS website manually
- Identify correct files
- Download via web browser
- Place in expected directory structure
- Continue with parsing/ingestion pipeline

**Pros**: Guaranteed to work, provides learning about structure  
**Cons**: Not automatable, time-consuming for large datasets

### Option 3: Contact PDS Support
- Email PDS Geosciences Node support
- Ask for correct URL structure for UVVS CDR data
- Request if any migration/reorganization has occurred

**Contact**: [https://pds-geosciences.wustl.edu/contact/](https://pds-geosciences.wustl.edu/contact/)

## Expected Resolution

### If URL is Simply Wrong
- **Effort**: Low (update URL, test, commit)
- **Time**: < 1 hour
- **Risk**: Low

### If Archive Reorganized
- **Effort**: Medium (map new structure, update all URLs, test all datasets)
- **Time**: 2-4 hours
- **Risk**: Medium (may affect other datasets)

### If Data Moved/Archived
- **Effort**: High (find new location, possibly change approach)
- **Time**: 4-8 hours
- **Risk**: High (may need PDS API integration)

## Documentation Updates Needed After Resolution

Once the issue is resolved, update:
- [ ] `tools/pds_downloader_native.py` - Correct URL
- [ ] `docs/dev/worklog/2025-10-31_pds_downloader_refinement.md` - Add resolution
- [ ] `docs/history/KNOWLEDGE_LOG.md` - Log what was learned
- [ ] `docs/history/PATCH_NOTES.md` - Note the fix
- [ ] This file - Document root cause and solution
- [ ] `docs/Telescope-Based Planetary datasets.md` - Update URLs if needed

## Related Issues

- None currently, but similar issues may exist for:
  - VIRS CDR dataset (different URL path)
  - UVVS DDR dataset (new dataset type added)
  - VIRS DDR dataset (new dataset type added)

Should test all four datasets once resolution is found.

## References

- MESSENGER MASCS Archive: [https://pds-geosciences.wustl.edu/missions/messenger/mascs.htm](https://pds-geosciences.wustl.edu/missions/messenger/mascs.htm)
- PDS Geosciences Node: [https://pds-geosciences.wustl.edu/](https://pds-geosciences.wustl.edu/)
- PDS Contact Form: [https://pds-geosciences.wustl.edu/contact/](https://pds-geosciences.wustl.edu/contact/)
- `tools/pds_downloader_native.py` - Downloader implementation
- `docs/dev/worklog/2025-10-31_pds_downloader_refinement.md` - Full change documentation
- `docs/brains/2025-10-31T1938-pds-downloader-filtering-strategy.md` - Architectural decisions

---

**Status**: Awaiting manual investigation of PDS archive structure  
**Assigned**: To be investigated by user or next agent  
**Priority**: Medium (blocks automated Mercury data acquisition)  
**Last Updated**: 2025-10-31T19:38:48-04:00 (EDT)
