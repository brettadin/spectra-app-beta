# Feature Parity Matrix

The table below maps existing features of the Spectra‑App Streamlit prototype to their planned equivalents (or deprecations) in the new standalone desktop application.  The goal is to ensure that no core capability is lost during the redesign and to document any deliberate changes.  Where the redesign introduces improvements, rationale is provided.

| Existing Feature | Observed Implementation | Planned Equivalent in New App | Notes |
|---|---|---|---|
| **Local file ingestion (CSV/TXT)** | Implemented via Streamlit file uploader; ingest function reads CSV, extracts wavelength and flux columns, guesses units. | **Data Ingest Module** with drag‑and‑drop area; supports CSV, TXT, JCAMP‑DX, FITS, HDF5 and JSON.  Users specify column mappings if not auto‑detected.  Importers are plugins; new formats can be added without touching core code. | Canonical units preserved; conversion options available only after import. |
| **Provider search (NIST IR Quant)** | Sidebar search sends HTTP requests to `nist_quant_ir.available_species()` and downloads spectra. | **External Providers Service** exposed through a search dialog.  Built‑in providers for NIST, telescope archives and future APIs.  Provider modules implement a common interface returning data and metadata. | Adds ability to manage API keys and offline caches. |
| **Overlay multiple spectra** | `OverlayTrace` dataclass stores wavelength, flux and metadata; UI adds each trace to Plotly figure; legend can become cluttered. | **Overlay Manager** with list view showing all loaded spectra.  Users can rename, reorder or hide traces.  Chart component uses a more compact legend or an interactive trace list. | Duplicate detection uses SHA‑256 fingerprint of raw data. |
| **Unit conversion toggles (nm ↔ μm ↔ Å ↔ cm⁻¹)** | UI offers radio buttons; conversions multiply arrays directly, causing cumulative errors. | **Units Service** that stores wavelengths internally in nm and computes derived units on the fly for display.  Users can select display unit for each axis. | Conversions are idempotent; internal data is never mutated. |
| **Differential operations (subtract and ratio)** | Functions in `server/differential.py` resample spectra to common grid and compute A−B or A/B with epsilon【948877707604069†L9-L32】.  Zero‑division spikes appear. | **Math Panel** with operations: difference, ratio, normalized difference, smoothing.  Resampling uses centralised interpolation service.  Ratio masks points where denominator < ε and shows a warning.  Subtracting identical spectra yields a suppressed result and informational toast. | Adds ability to normalise before computing differences. |
| **Functional‑group identification (IR groups)** | Calls `ir_group_client.identify_functional_groups()` via remote ML service and overlays shaded bands using `apply_shaded_ranges()` in UI. | **ML Plugin System** that can run local or remote models.  Built‑in IR functional‑group classifier is provided; additional models can be dropped into a `plugins/` folder with manifest.  Results appear in the **Functional Groups** tab as a table and overlay bands. | Provides version and licence of model in provenance. |
| **Similarity search** | Computes spectral vectors and queries an in‑memory search cache. | **Similarity Service** with pluggable distance metrics (cosine, Euclidean, correlation).  Presents results in a table with thumbnails. | Can query remote or local libraries. |
| **Export manifest and snapshot** | `export_manifest.py` writes a JSON manifest and PNG of the plot. | **Export Wizard** that packages selected spectra, derived data, chart images and a manifest into a user‑chosen format (e.g. ZIP).  Manifest follows the new provenance schema. | Adds option to include raw inputs and transforms. |
| **Brains/atlas self‑learning** | `continuity.py` reads and writes logs, but integration with UI is minimal. | **Knowledge Log** integrated into the app.  Every action writes an entry to `docs/history/KNOWLEDGE_LOG.md` via an internal API.  The desktop app exposes a **History** tab showing recent actions and AI suggestions. | Strengthens AI ↔ user communication. |
| **Version badge** | Streamlit renders version and build date in a floating badge【949348365484271†L14-L40】. | **About dialog** in the desktop app displaying version, build date, licence, citation information and third‑party credits. | Moves badge into a dedicated dialog accessible from the menu. |
| **Testing (unit tests)** | Pytest tests cover some modules (e.g. downsample, duplicate ledger). | **Comprehensive Test Suite** with unit tests for parsers, converters, math operations and plugin interfaces; golden‑image tests for the plotting component; integration tests for the overlay manager. | Run via CI on every pull request. |

### Deprecated or Changed Features

| Feature | Rationale for Change | Action |
|---|---|---|
| **Streamlit web interface** | The brief requires a standalone Windows application with a professional desktop UI, and the current Streamlit approach leads to double‑click bugs and a cluttered interface【875267955107972†L5-L9】【875267955107972†L29-L41】. | Replace Streamlit with a native UI framework (PySide6/Qt or Tauri) and implement the same functionality in a multi‑tab window. |
| **Dynamic patch file naming (day‑only)** | Causes confusion in the logs and was highlighted as inaccurate【875267955107972†L63-L74】. | Normalise logs using ISO‑8601 dates and unify them under `docs/history/`. |
| **Implicit unit mutation** | Mutating arrays in place leads to cumulative errors. | Adopt canonical internal units and derive display units. |
| **Unstructured ML endpoints** | Current ML integration is hard‑coded and insecure. | Provide a plugin system with manifests and versioning. |

This matrix will be kept up‑to‑date as the redesign progresses and new features are added.